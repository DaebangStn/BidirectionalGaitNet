// Motion Data Flow Diagram
// BidirectionalGaitNet Viewer - Unified Motion Processing Pipeline
// Generate: dot -Tpng -o motion_data_flow.png motion_data_flow.dot

digraph MotionDataFlow {
    rankdir=LR;
    node [shape=box, style="rounded,filled", fontname="Helvetica", fontsize=10];
    edge [fontname="Helvetica", fontsize=9];
    splines=polyline;

    labelloc="t";
    label="Motion Data Flow";
    fontsize=14;
    fontname="Helvetica-Bold";

    // ==================== INPUT ====================
    subgraph cluster_input {
        label="Input";
        style="rounded,filled";
        fillcolor="#F5F5F5";

        HDF_File [label=".h5 / .hdf5" fillcolor="#FFE4B5" shape=note];
        C3D_File [label=".c3d" fillcolor="#FFE4B5" shape=note];
    }

    // ==================== LOAD ====================
    subgraph cluster_load {
        label="Load";
        style="rounded,filled";
        fillcolor="#E8F4FD";

        Load [
            label="MotionProcessor::load()\n\n.h5/.hdf5 â†’ new HDF()\n.c3d â†’ C3D_Reader"
            fillcolor="#87CEEB"
        ];
    }

    // ==================== MOTION ====================
    subgraph cluster_motion {
        label="Motion Object";
        style="rounded,filled";
        fillcolor="#E8FDE8";

        HDF_Obj [label="HDF\nsourceType=\"hdf\"\nparams, timestamps" fillcolor="#90EE90"];
        C3D_Obj [label="C3D\nsourceType=\"c3d\"\nposes, markers" fillcolor="#90EE90"];
    }

    // ==================== PROCESS ====================
    subgraph cluster_process {
        label="Process";
        style="rounded,filled";
        fillcolor="#FFF8E8";

        Playback [
            label="computePlayback()\n\n1. Determine frame\n2. Interpolate pose\n3. Apply offsets\n4. Update markers (C3D)"
            fillcolor="#FFD700"
        ];
    }

    // ==================== OUTPUT ====================
    subgraph cluster_output {
        label="Output";
        style="rounded,filled";
        fillcolor="#FDE8E8";

        Context [
            label="MotionProcessorContext\n\ncurrentPose\ncurrentMarkers\nframeIndex"
            fillcolor="#FF9090"
        ];
    }

    // ==================== RENDER ====================
    subgraph cluster_render {
        label="Render";
        style="rounded,filled";
        fillcolor="#E8E8FD";

        Skeleton [label="drawSkeleton()" fillcolor="#B0B0FF"];
        Markers [label="drawMarkers()\n(C3D only)" fillcolor="#B0B0FF"];
    }

    // ==================== EDGES ====================
    HDF_File -> Load;
    C3D_File -> Load;

    Load -> HDF_Obj [label="creates"];
    Load -> C3D_Obj [label="creates"];

    HDF_Obj -> Playback [label="Motion*"];
    C3D_Obj -> Playback [label="Motion*"];

    Playback -> Context;

    Context -> Skeleton [label="pose"];
    Context -> Markers [label="markers"];
}
