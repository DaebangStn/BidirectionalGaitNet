# Muscle Personalizer Application Configuration
# NOTE: Window geometry and default_open_panels are in render.yaml

metadata:
  version: "1.0"
  description: "Muscle personalization tool configuration"

# Default paths
paths:
  rom_config_dir: "@data/config/rom"
  hdf_motions_dir: "@data/motions"
  skeleton_default: "@data/skeleton/gmfcs3.yaml"
  muscle_default: "@data/muscle/base.yaml"
  # Reference character for waypoint optimization (standard/ideal muscle behavior)
  reference_skeleton: "@data/skeleton/base.yaml"
  reference_muscle: "@data/muscle/base.yaml"

# Weight scaling defaults
weight_scaling:
  reference_mass: 50.0    # kg
  default_target: 50.0    # kg

# Waypoint optimization defaults
waypoint_optimization:
  analytical_gradient: false
  fix_origin_insertion: false
  use_normalized_length: true
  max_iterations: 500
  num_sampling: 200
  lambda_shape: 1.0
  lambda_length_curve: 0.2
  weight_phase: 1.0      # weight for (min_phase - ref)² + (max_phase - ref)²
  weight_delta: 5.0     # weight for (delta - ref)²
  weight_samples: 1.0    # weight for sample loss at N phase points
  num_phase_samples: 4   # number of evenly-spaced phase points (3 → 0, 0.5, 1.0)
  loss_power: 2          # Power exponent (2=squared, 3=cube)
  parallelism: 32
  max_displacement: 0.2          # Max waypoint displacement (meters)
  max_displacement_origin_insertion: 0.03  # Tighter constraint for origin/insertion
  function_tolerance: 1e-5       # Convergence tolerance on cost function
  gradient_tolerance: 1e-6      # Convergence tolerance on gradient
  parameter_tolerance: 1e-5      # Convergence tolerance on parameters
  adaptive_sample_weight: false  # Adaptive weighting based on normalized length

# Contracture estimation defaults
contracture_estimation:
  max_iterations: 100
  min_ratio: 0.7
  max_ratio: 1.2
  solver_verbose: false
  grid_search:
    begin: 0.7
    end: 1.3
    interval: 0.1

# Muscle visualization
visualization:
  color_by_contracture: true
  contracture_colormap: "viridis"  # viridis, plasma, coolwarm
  min_color_value: 0.7
  max_color_value: 1.2
