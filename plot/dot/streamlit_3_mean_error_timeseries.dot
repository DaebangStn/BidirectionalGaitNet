digraph MeanErrorTimeseries {
  rankdir=LR;
  splines=ortho;
  nodesep=0.5;
  ranksep=0.8;
  fontname="Helvetica";
  label=<<font point-size="14"><b>View: Mean Error Time Series</b></font>>;
  labelloc=t;

  node [
    shape=box,
    style="rounded,filled",
    fillcolor="white",
    color="gray30",
    fontname="Helvetica",
    fontsize=10,
    margin="0.12,0.08"
  ];

  edge [
    color="gray30",
    penwidth=1.2,
    arrowsize=0.7,
    fontname="Helvetica",
    fontsize=8
  ];

  // ─────────────────────────────────────────────────────────────
  // Cluster: Controls (render_controls)
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_controls {
    style=filled;
    fillcolor="#E3F2FD";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">render_controls()</font>>;

    ctrl_char [label="char_type\n[both|free|motion]"];
    ctrl_ymin [label="ymin\n(slider + input)"];
    ctrl_ymax [label="ymax\n(slider + input)"];
    ctrl_info [label="show_info\n(checkbox)"];
    ctrl_grid [label="show_grid\n(checkbox)"];
  }

  // ─────────────────────────────────────────────────────────────
  // Controls Dict
  // ─────────────────────────────────────────────────────────────
  controls_dict [label=<
    <table border="0" cellborder="0" cellspacing="2">
      <tr><td colspan="2"><b>controls dict</b></td></tr>
      <tr><td align="left">char_type:</td><td align="left">"both"</td></tr>
      <tr><td align="left">ymin:</td><td align="left">0.0</td></tr>
      <tr><td align="left">ymax:</td><td align="left">10.0</td></tr>
      <tr><td align="left">show_info:</td><td align="left">True</td></tr>
      <tr><td align="left">show_grid:</td><td align="left">True</td></tr>
    </table>
  >, shape=record, fillcolor="#FFF9C4"];

  // ─────────────────────────────────────────────────────────────
  // Cluster: Data Input
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_data {
    style=filled;
    fillcolor="#F1F8E9";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">Data Input</font>>;

    data_free [label="marker_error_\nfree_mean\n(frames,)"];
    data_motion [label="marker_error_\nmotion_mean\n(frames,)"];
  }

  // ─────────────────────────────────────────────────────────────
  // Cluster: Rendering Pipeline
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_render {
    style=filled;
    fillcolor="#F3E5F5";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">render_plot()</font>>;

    branch [label="char_type\nbranch", shape=diamond, fillcolor="#E1BEE7"];
    line_free [label="Line Plot\n(blue)"];
    line_motion [label="Line Plot\n(red)"];
    line_both [label="Overlay\nPlot"];
  }

  // ─────────────────────────────────────────────────────────────
  // Cluster: Output
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_output {
    style=filled;
    fillcolor="#ECEFF1";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">matplotlib Output</font>>;

    output [label=<
      <table border="0" cellborder="0" cellspacing="2">
        <tr><td><b>Line Plot</b></td></tr>
        <tr><td>X: frames</td></tr>
        <tr><td>Y: mean error</td></tr>
        <tr><td>free=blue</td></tr>
        <tr><td>motion=red</td></tr>
      </table>
    >, shape=record, fillcolor="#CFD8DC"];
  }

  // ─────────────────────────────────────────────────────────────
  // Edges
  // ─────────────────────────────────────────────────────────────
  ctrl_char -> controls_dict [penwidth=1.5];
  ctrl_ymin -> controls_dict [penwidth=1.5];
  ctrl_ymax -> controls_dict [penwidth=1.5];
  ctrl_info -> controls_dict [penwidth=1.5];
  ctrl_grid -> controls_dict [penwidth=1.5];

  controls_dict -> branch [penwidth=2.0, color="black"];
  data_free -> branch [penwidth=2.0, color="black"];
  data_motion -> branch [penwidth=2.0, color="black"];

  branch -> line_free [label="\"free\"", penwidth=1.5];
  branch -> line_motion [label="\"motion\"", penwidth=1.5];
  branch -> line_both [label="\"both\"", penwidth=1.5];

  line_free -> output [penwidth=2.0, color="black"];
  line_motion -> output [penwidth=2.0, color="black"];
  line_both -> output [penwidth=2.0, color="black"];

  // Rank alignment
  {rank=same; ctrl_char; ctrl_ymin; ctrl_ymax; ctrl_info; ctrl_grid;}
  {rank=same; data_free; data_motion;}
  {rank=same; line_free; line_motion; line_both;}
}
