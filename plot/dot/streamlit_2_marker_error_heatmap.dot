digraph MarkerErrorHeatmap {
  rankdir=LR;
  splines=ortho;
  nodesep=0.5;
  ranksep=0.8;
  fontname="Helvetica";
  label=<<font point-size="14"><b>View: Marker Error Heatmap</b></font>>;
  labelloc=t;

  node [
    shape=box,
    style="rounded,filled",
    fillcolor="white",
    color="gray30",
    fontname="Helvetica",
    fontsize=10,
    margin="0.12,0.08"
  ];

  edge [
    color="gray30",
    penwidth=1.2,
    arrowsize=0.7,
    fontname="Helvetica",
    fontsize=8
  ];

  // ─────────────────────────────────────────────────────────────
  // Cluster: Controls (render_controls)
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_controls {
    style=filled;
    fillcolor="#E3F2FD";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">render_controls()</font>>;

    ctrl_char [label="char_type\n[both|free|motion]"];
    ctrl_vmin [label="vmin\n(slider + input)"];
    ctrl_vmax [label="vmax\n(slider + input)"];
    ctrl_info [label="show_info\n(checkbox)"];
  }

  // ─────────────────────────────────────────────────────────────
  // Controls Dict
  // ─────────────────────────────────────────────────────────────
  controls_dict [label=<
    <table border="0" cellborder="0" cellspacing="2">
      <tr><td colspan="2"><b>controls dict</b></td></tr>
      <tr><td align="left">char_type:</td><td align="left">"both"</td></tr>
      <tr><td align="left">vmin:</td><td align="left">0.0</td></tr>
      <tr><td align="left">vmax:</td><td align="left">10.0</td></tr>
      <tr><td align="left">show_info:</td><td align="left">True</td></tr>
    </table>
  >, shape=record, fillcolor="#FFF9C4"];

  // ─────────────────────────────────────────────────────────────
  // Cluster: Data Input
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_data {
    style=filled;
    fillcolor="#F1F8E9";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">Data Input</font>>;

    data_free [label="marker_error_\nfree_data\n(F x M)"];
    data_motion [label="marker_error_\nmotion_data\n(F x M)"];
    data_names [label="marker_names\n[str, ...]"];
  }

  // ─────────────────────────────────────────────────────────────
  // Cluster: Rendering Pipeline
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_render {
    style=filled;
    fillcolor="#F3E5F5";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">render_plot()</font>>;

    branch [label="char_type\nbranch", shape=diamond, fillcolor="#E1BEE7"];
    plot_free [label="Heatmap\n(free)"];
    plot_motion [label="Heatmap\n(motion)"];
    plot_both [label="Side-by-side\nHeatmaps"];
  }

  // ─────────────────────────────────────────────────────────────
  // Cluster: Output
  // ─────────────────────────────────────────────────────────────
  subgraph cluster_output {
    style=filled;
    fillcolor="#ECEFF1";
    color="gray70";
    penwidth=0.5;
    label=<<font point-size="9">matplotlib Output</font>>;

    output [label=<
      <table border="0" cellborder="0" cellspacing="2">
        <tr><td><b>Heatmap</b></td></tr>
        <tr><td>X: frames</td></tr>
        <tr><td>Y: markers</td></tr>
        <tr><td>colormap: 'hot'</td></tr>
      </table>
    >, shape=record, fillcolor="#CFD8DC"];
  }

  // ─────────────────────────────────────────────────────────────
  // Edges
  // ─────────────────────────────────────────────────────────────
  ctrl_char -> controls_dict [penwidth=1.5];
  ctrl_vmin -> controls_dict [penwidth=1.5];
  ctrl_vmax -> controls_dict [penwidth=1.5];
  ctrl_info -> controls_dict [penwidth=1.5];

  controls_dict -> branch [penwidth=2.0, color="black"];
  data_free -> branch [penwidth=2.0, color="black"];
  data_motion -> branch [penwidth=2.0, color="black"];
  data_names -> branch [penwidth=1.0, color="gray50"];

  branch -> plot_free [label="\"free\"", penwidth=1.5];
  branch -> plot_motion [label="\"motion\"", penwidth=1.5];
  branch -> plot_both [label="\"both\"", penwidth=1.5];

  plot_free -> output [penwidth=2.0, color="black"];
  plot_motion -> output [penwidth=2.0, color="black"];
  plot_both -> output [penwidth=2.0, color="black"];

  // Rank alignment
  {rank=same; ctrl_char; ctrl_vmin; ctrl_vmax; ctrl_info;}
  {rank=same; data_free; data_motion; data_names;}
  {rank=same; plot_free; plot_motion; plot_both;}
}
